<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Bookmark App</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">

var isLoggedIn = true
const defaultUri = "https://external-preview.redd.it/TcSzPOpGNxov4-zHd11YfCQP95CXM5aCY2FXxW8lwnU.jpg?auto=webp&s=1c4120f8d6c8a794b21d67d5b390db34f623ccf1"
var gUri = defaultUri

function GuestGreeting(props) {
  return (<div><a id="register" href="https://solid.inrupt.com/get-a-solid-pod" target="_blank" className="button is-primary">
              <strong>Sign up</strong>
            </a>
            <a id="login" className="button is-light">
              Login
            </a></div>);
}

function UserGreeting(props) {
  return (<div><a id="logout" className="button is-light" >
              Logout
            </a></div>)
}

function Greeting(props) {
  const isLoggedIn = props.isLoggedIn;
  if (isLoggedIn) {
    return <UserGreeting isLoggedIn={isLoggedIn} />;
  }
  return <GuestGreeting isLoggedIn={isLoggedIn} />;
}

function MenuGreeting(props) {
    return <div className="navbar-item">
<div className="buttons">
  <Greeting isLoggedIn={isLoggedIn} />
</div>
</div>

}

function MenuAbout(props) {
    return         <div className="navbar-item has-dropdown is-hoverable">
          <a className="navbar-link">
            About
          </a>        

          <div className="navbar-dropdown">

            <a className="navbar-item">
                About
            </a>

            <hr />

            <a target="_blank" href="">
              Help
            </a>

          </div>
        </div>
}

function Menu(props) {
    var title = props.title || 'Welcome'
    var className = props.className || 'is-link'

    // init
    className = 'navbar ' + className

  return <nav className={className} role="navigation" aria-label="main navigation">
    <div className="navbar-brand">

      <a id="add" className="navbar-item" href="#">
        {title}
      </a>

      <a role="button" className="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbarBasicExample" className="navbar-menu">
      <div className="navbar-start">
        <MenuAbout/>
      </div>

      <div className="navbar-end">
        <MenuGreeting/>
      </div>
    </div>
  </nav>
}

class Bookmark extends React.Component {
    constructor(props) {
        super(props)
        var uri = getQueryStringParam("uri") || defaultUri
        this.state = { uri : uri }
        this.handleChange = this.handleChange.bind(this)
    }

    handleChange(e) {
      this.setState({uri: event.target.value})
      gUri = getQueryStringParam("uri")
      console.log("gUri", gUri)
      console.log("this.state.uri", this.state.uri)
    }

    render() {
    return         <div>
    <img src={this.uri}/>
        </div>
    }

}

function getQueryStringParam(param) {
      var url = window.location.toString();
      url.match(/\?(.+)$/);
      var params = RegExp.$1;
      params = params.split("&");
      var queryStringList = {};
      for (var i = 0; i < params.length; i++) {
        var tmp = params[i].split("=");
        queryStringList[tmp[0]] = unescape(tmp[1]);
      }
      return queryStringList[param];
    }


class InputUri extends React.Component {
    constructor(props) {
        super(props)
        var uri = getQueryStringParam("uri") || defaultUri
        this.state = { uri : uri }
        this.handleChange = this.handleChange.bind(this)
    }

    handleChange(e) {
      this.setState({uri: e.target.value })
      gUri = getQueryStringParam("uri")
      console.log("gUri", gUri)
      console.log("this.state.uri", this.state.uri)
      console.log("this.uri", this.uri)
    }

    render() {

        return <div>
        Uri : <input size="80" onChange={this.handleChange} placeholder="uri" value={this.uri}/>

    <img src={this.state.uri}/>
        </div>
    }

}


function Body(props) {
    return (
    <div>

      <section className="section">
      <h1 id="welcome" className="title">
        Mark Book!
      </h1>
        <InputUri />
        <Bookmark/>
      </section>

    </div>
  );
}


function App() {
  return (
    <div>
      <Menu className="is-link" title="Bookmark App"/>
      <Body/>

    </div>
  );
}

ReactDOM.render(
  <App />,
  document.getElementById('root')
);

    </script>
    <script>
        function hamburgerHelper() {
            document.querySelector(".navbar-burger").addEventListener("click", toggleNav);

            function toggleNav() {
                var nav = document.querySelector(".navbar-menu");
                if (nav.className == "navbar-menu") {
                    nav.className = "navbar-menu is-active";
                } else {
                    nav.className = "navbar-menu";
                }
            }
        }
        // @TODO : move this into Menu class
        setTimeout(hamburgerHelper, 1000)
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" defer>

</body>

</html>